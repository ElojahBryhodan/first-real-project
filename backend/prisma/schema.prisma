// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String        @id @default(uuid())
  email        String        @unique
  passwordHash String
  username     String
  balanceCents Int           @default(0)
  wins         Int           @default(0)
  losses       Int           @default(0)
  role         Role          @default(USER)
  createdAt    DateTime      @default(now())

  createdMatches Match[]     @relation("CreatedMatches")
  joinedMatches  Match[]     @relation("JoinedMatches")
  wonMatches     Match[]     @relation("WonMatches")
  ledgerEntries  LedgerEntry[]
}

enum Role {
  USER
  ADMIN
  SUPER_ADMIN
}

enum MatchStatus {
  WAITING
  IN_PROGRESS
  FINISHED
  DISPUTE
}

model Match {
  id               String       @id @default(uuid())
  game             String
  entryFeeCents    Int
  status           MatchStatus  @default(WAITING)
  createdAt        DateTime     @default(now())
  updatedAt        DateTime     @updatedAt

  createdById      String
  createdBy        User         @relation("CreatedMatches", fields: [createdById], references: [id])

  joinedById       String?      
  joinedBy         User?        @relation("JoinedMatches", fields: [joinedById], references: [id])

  winnerId         String?
  winner           User?        @relation("WonMatches", fields: [winnerId], references: [id])

  commissionCents  Int?
  prizeCents       Int?

  ledgerEntries    LedgerEntry[]
}

enum LedgerEntryType {
  ENTRY_FEE
  WIN_PAYOUT
  COMMISSION
  ADJUSTMENT
}

model LedgerEntry {
  id          String          @id @default(uuid())
  userId      String
  user        User            @relation(fields: [userId], references: [id])
  type        LedgerEntryType
  amountCents Int
  matchId     String?
  match       Match?          @relation(fields: [matchId], references: [id])
  createdAt   DateTime        @default(now())
}

model PlatformConfig {
  id                    Int    @id @default(1)
  defaultEntryFeeCents  Int    @default(500)
  commissionBps         Int    @default(500)
}

